#!/bin/sh

music_dir="${XDG_MUSIC_DIR:-$HOME/Music}"
music_txt="${music_dir}/.music.txt"

selected_filename=$(find "$music_dir" -type f -printf "%f\n" | dmenu -i -l 20 -p "Select a file to delete:") || exit 1

selected_file="$music_dir/$selected_filename"

video_id=$(strings "$selected_file" | grep -oP 'watch\?v=\K[\w-]+' | head -1) || {
	notify-send "❌ No YouTube video ID found in file: $selected_filename"
	exit 1
}

confirm=$(echo -e "Yes\nNo" | dmenu -i -p "Delete $selected_filename and update mpc?")

[ "$confirm" == "Yes" ] || {
	notify-send "❌ Operation cancelled."
	exit 0
}

rm "$selected_file" && sed -i "/$video_id/d" "$music_txt" && mpc update >/dev/null && {
	notify-send "🎵 Success to delete:" "$selected_filename"
} || {
	notify-send "❌ An error occurred."
}
